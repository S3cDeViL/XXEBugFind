/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package bugfind.xxe;

import bugfind.sootadapters.MethodDefinition;
import java.util.ArrayList;
import java.util.List;
import javax.xml.stream.XMLInputFactory;

/**
 *
 * @author Mikosh
 */
public class VulnerabilityMitigationItem {
    public static final int LOCAL = -0, GLOBAL = -10;
    private MethodDefinition methodDefinition;
    private List<MethodParameterValue> parameterValues;
    private int type;
    private String solutionDescription;

    public VulnerabilityMitigationItem(MethodDefinition methodDefinition, List<MethodParameterValue> parameterValues 
            , int type) {
        // first ensure the methoddefition and paramater values are compatible // 
        // make sure the parametervalue list is not null;
        parameterValues = (parameterValues == null) ? new ArrayList<MethodParameterValue>() : parameterValues;
        ensureParametersCompatibility(methodDefinition.getParameterList(), parameterValues);
        
        if (type != LOCAL && type != GLOBAL) {
            throw new IllegalArgumentException("Invalid vulnerability mitigation type given");
        }
        
        this.methodDefinition = methodDefinition;
        this.parameterValues = parameterValues;
        this.type = type;
    }
    
    private void ensureParametersCompatibility(List<MethodDefinition.MethodParameter> listMP, List<MethodParameterValue> listPV) {
        if (listMP.size() != listPV.size()) {
            throw new IllegalArgumentException("The number of parameter values should be equal to the number parameters "
                    + "expected by the method. Method expects " + listMP.size() + " but " + listPV.size() + " values were supplied.");            
        }
        for (int i=0; i< listMP.size(); ++i) {
            MethodDefinition.MethodParameter mp = listMP.get(i);
            MethodParameterValue pv = listPV.get(i);
            if (!mp.getType().equals(pv.getType())) {
                throw new RuntimeException("The method parameter type for argumemt " + (i+1) + " differs from the expected "
                        + "parameter value type (ie method parameter incompatible with value) See detail: MethodParameterType: " + 
                        mp.getType() + " != ParameterValueType: " + pv.getType());
            }
        }
        
        // may want to check valid values for primitive types
        
        // if method reaches here, it means there was no problem
    }

    public MethodDefinition getMethodDefinition() {
        return methodDefinition;
    }

    public List<MethodParameterValue> getParameterValues() {
        return parameterValues;
    }  

    public int getType() {
        return type;
    }
    
    public boolean isLocalMitigation() {
        return (type == VulnerabilityMitigationItem.LOCAL);
    }
    
    public boolean isGlobalMitigation() {
        return (type == VulnerabilityMitigationItem.GLOBAL);
    }

    public String getSolutionDescription() {
        return solutionDescription;
    }

    public void setSolutionDescription(String solutionDescription) {
        this.solutionDescription = solutionDescription;
    }
    
    
    
}
